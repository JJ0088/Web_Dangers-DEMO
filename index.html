<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Cybersecurity Interactive Demo</title>
  <style>
    body {
      font-family: monospace;
      background: linear-gradient(135deg, #000 0%, #111 50%, #000 100%);
      color: #0f0;
      padding: 20px;
      animation: bgMove 15s infinite alternate;
    }
    @keyframes bgMove {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }
    .box {
      border: 1px solid #0f0;
      padding: 10px;
      margin: 15px 0;
      background: #000;
      min-height: 200px;
      white-space: pre-wrap;
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #fff;
      padding: 20px;
      border: 2px solid #f33;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="output" class="box"></div>

  <div id="popup" class="popup">
    <h2>⚠️ 2° Errore</h2>
    <p>Hai cliccato! Questo file scaricato era innocuo, ma in un sito malevolo 
    avrebbe potuto essere un malware. Pensa prima di agire.</p>
    <button onclick="document.getElementById('popup').style.display='none'">Chiudi</button>
  </div>

  <script>
    // ---- Fingerprinting base ----
    function getGPU() {
      try {
        let canvas = document.createElement("canvas");
        let gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (!gl) return "N/A";
        let debugInfo = gl.getExtension("WEBGL_debug_renderer_info");
        return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "N/A";
      } catch(e) {
        return "N/A";
      }
    }

    let info = {
      userAgent: navigator.userAgent,
      language: navigator.language,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      screen: screen.width + "x" + screen.height,
      gpu: getGPU()
    };

    // ---- Funzione digitazione lenta ----
    function typeEffect(element, text, delay = 40, callback) {
      let i = 0;
      function addChar() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(addChar, delay);
        } else if (callback) {
          callback();
        }
      }
      addChar();
    }

    // ---- Output box ----
    let output = document.getElementById("output");

    // ---- Messaggio di benvenuto ----
    let lang = info.language.startsWith("it") ? "it" : "en";
    let welcomeMsg = lang === "it" ? "Benvenuto" : "Welcome";

    // Step 1: Benvenuto + info browser base
    typeEffect(output, `${welcomeMsg} ${info.userAgent}!\nSembra tu stia usando ${info.userAgent} per connetterti.\n\n`, 50, () => {
      let browserInfo = 
        `Browser info:\n` +
        `User-Agent: ${info.userAgent}\n` +
        `Lingua: ${info.language}\n` +
        `Fuso orario: ${info.timezone}\n` +
        `Risoluzione: ${info.screen}\n` +
        `GPU: ${info.gpu}\n\nCarico info IP...\n`;
      typeEffect(output, browserInfo, 40, loadIP);
    });

    // ---- Funzione per caricare IP e VPN ----
    function loadIP() {
      fetch("https://ipapi.co/json/")
        .then(res => res.json())
        .then(data => {
          let ipInfo = 
            `IP info:\n` +
            `IP: ${data.ip}\n` +
            `Nazione: ${data.country_name}\n` +
            `ISP/Org: ${data.org}\n`;
          let vpnMsg = (data.org && (data.org.toLowerCase().includes("vpn") || data.org.toLowerCase().includes("hosting")))
            ? (lang === "it" ? "Sembra che tu stia usando una VPN/Proxy." : "It seems you are using a VPN/Proxy.")
            : (lang === "it" ? "Non sembri dietro VPN. Attento!" : "You are not behind a VPN. Be careful!");
          typeEffect(output, ipInfo + vpnMsg + "\n", 40);
        })
        .catch(err => {
          typeEffect(output, lang === "it" ? "\nErrore nel recupero IP.\n" : "\nError retrieving IP.\n", 40);
        });
    }

    // ---- Primo click = download + popup ----
    let clicked = false;
    document.body.addEventListener("click", () => {
      if (!clicked) {
        clicked = true;
        let blob = new Blob([lang === "it" ? "2° errore: non cliccare" : "2nd error: do not click"], {type: "text/plain"});
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "errore.txt";
        link.click();
        document.getElementById("popup").style.display = "block";
      }
    });
  </script>
</body>
</html>

